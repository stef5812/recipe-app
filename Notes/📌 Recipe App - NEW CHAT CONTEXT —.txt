ğŸ“Œ Recipe App - NEW CHAT CONTEXT â€”  (Production & Dev)

Project: Mumâ€™s Recipes (Recipe App)
Owner: Stefan Dodds
Domain: https://stefandodds.ie
Server: Hostinger VPS (Ubuntu)
Version control: GitHub
Deployment: git pull on server

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¯ PROJECT GOAL
A full-stack recipe website where:
- Recipes can be created, edited, and listed
- Images are uploaded and served
- Data is stored safely in PostgreSQL
- Frontend is static (Vite build)
- Backend is API-only (Express)
- App is stable during git push â†’ pull â†’ deploy

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§± ARCHITECTURE OVERVIEW

Frontend
- Vite + React
- Built with `npm run build`
- Output: `dist/`
- Served by Nginx (static files)
- NO hard-coded ports
- Uses relative API paths only: `/api/...`

Backend
- Node.js (ESM)
- Express
- Prisma ORM
- Multer for image uploads
- Runs independently from frontend
- Health check endpoint available

Database
- PostgreSQL 16
- Runs in Docker container
- Persistent volume
- Prisma manages schema & migrations

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ SERVER FILE STRUCTURE

/var/www/recipe-app/
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ vite.config.js
â”‚   â””â”€â”€ dist/               â† built output
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â””â”€â”€ server.js
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma
â”‚   â”œâ”€â”€ uploads/            â† recipe images (NOT in git)
â”‚   â”œâ”€â”€ .env
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ docker/
    â””â”€â”€ postgres container

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸŒ NGINX CONFIG (KEY POINTS)

Frontend
- Serves `/var/www/recipe-app/frontend/dist`
- Mounted at root or subpath (depending on config)

API
- `/api/*` â†’ proxied to backend (Node)
- `/uploads/*` â†’ proxied to backend

Example pattern:
location /api/ {
  proxy_pass http://127.0.0.1:XXXX;
}

location /uploads/ {
  proxy_pass http://127.0.0.1:XXXX;
}

Frontend NEVER talks to ports directly.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âš™ï¸ VITE CONFIG (IMPORTANT)

vite.config.js:
- `base` must match Nginx path (e.g. "/" or "/recipes/")
- Dev proxy may exist, but is ignored in production

Example:
export default defineConfig({
  base: "/",
  server: {
    proxy: {
      "/api": "http://127.0.0.1:XXXX",
      "/uploads": "http://127.0.0.1:XXXX"
    }
  }
})

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ—„ï¸ DATABASE & PRISMA

- Prisma schema is source of truth
- Migrations must be run after schema changes
- Database container must be running BEFORE backend

Common commands:
- npx prisma migrate dev
- npx prisma generate
- docker ps
- docker start recipes_postgres

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸš€ DEPLOYMENT FLOW (SAFE)

On local machine:
1. Make changes
2. Test locally
3. git add .
4. git commit
5. git push

On server:
1. cd /var/www/recipe-app
2. git pull
3. Backend:
   - npm install (if needed)
   - restart backend process
4. Frontend:
   - cd frontend
   - npm install (if needed)
   - npm run build
   - dist/ replaces live frontend
5. nginx -t && systemctl reload nginx

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ§¨ COMMON PITFALLS (KNOWN ISSUES)

âŒ Hard-coded localhost or ports in frontend
âŒ Forgetting to rebuild frontend after JSX changes
âŒ Database container stopped
âŒ Prisma client not regenerated
âŒ Uploads folder accidentally added to git
âŒ Vite base path not matching Nginx

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ… HEALTH CHECKS

Backend:
GET /api/health
â†’ should return { ok: true }

Uploads:
- Images should load via /uploads/filename.jpg

Frontend:
- No console errors
- API calls relative, not absolute

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ“ IMPORTANT RULES

- Frontend is disposable (always rebuilt)
- Backend is stateful (depends on DB + uploads)
- uploads/ is NEVER committed
- Database is NEVER recreated unless intentional
- Nginx is the single entry point

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¯ CURRENT STATUS

- App works locally
- App works on server when deployed correctly
- Most issues come from missed rebuilds or path mismatches
- This context should be treated as authoritative

This is for the pull on the server for the recipe-app.

rsync -av --delete /var/www/recipe-app/frontend/dist/ /var/www/recipe-app/frontend-dist/
